--TEST--
Bug 514572 - Do better variable detection, highlighting and renaming in quoted strings and heredoc sections
--FILE--
<?php
$a(<<<NESTED
    ${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}
NESTED
);

$a = 5;
echo "${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}";
echo '${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}';

function a()
{
    global $a;
    $a = 10;
    $b = ${a};
    echo "${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}";
    echo `${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}`;
}
?>
--EXPECT--
PHP_TOKEN|<|2
PHP_TOKEN|?|2
PHP_LABEL|php|2
WHITESPACE|
|2
PHP_VARIABLE|$a|2
PHP_TOKEN|(|2
PHP_HEREDOC_TAG|<<<NESTED
|14
PHP_ENCAPSED_AND_WHITESPACE|    |12
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |12
PHP_CURLY_OPEN|{|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |12
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_CURLY_CLOSE|} |12
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|}
|12
PHP_HEREDOC_TAG|NESTED
|2
PHP_TOKEN|)|2
PHP_SEMICOLON|;|2
WHITESPACE|
|2
PHP_VARIABLE|$a|2
WHITESPACE| |2
PHP_TOKEN|=|2
WHITESPACE| |2
PHP_NUMBER|5|2
PHP_SEMICOLON|;|2
WHITESPACE|
|2
PHP_ECHO|echo|2
WHITESPACE| |2
PHP_CONSTANT_ENCAPSED_STRING|"|4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |4
PHP_CURLY_OPEN|{|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_CURLY_CLOSE|} |4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|}|4
PHP_CONSTANT_ENCAPSED_STRING|"|2
PHP_SEMICOLON|;|2
WHITESPACE|
|2
PHP_ECHO|echo|2
WHITESPACE| |2
PHP_CONSTANT_ENCAPSED_STRING|'${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}'|2
PHP_SEMICOLON|;|2
WHITESPACE|
|2
PHP_FUNCTION|function|2
WHITESPACE| |2
PHP_LABEL|a|2
PHP_TOKEN|(|2
PHP_TOKEN|)|2
WHITESPACE|
|2
PHP_CURLY_OPEN|{
    |2
PHP_GLOBAL|global|2
WHITESPACE| |2
PHP_VARIABLE|$a|2
PHP_SEMICOLON|;|2
WHITESPACE|
    |2
PHP_VARIABLE|$a|2
WHITESPACE| |2
PHP_TOKEN|=|2
WHITESPACE| |2
PHP_NUMBER|10|2
PHP_SEMICOLON|;|2
WHITESPACE|
    |2
PHP_VARIABLE|$b|2
WHITESPACE| |2
PHP_TOKEN|=|2
WHITESPACE| |2
PHP_TOKEN|$|2
PHP_CURLY_OPEN|{|2
PHP_LABEL|a|2
PHP_CURLY_CLOSE|}|2
PHP_SEMICOLON|;|2
WHITESPACE|
    |2
PHP_ECHO|echo|2
WHITESPACE| |2
PHP_CONSTANT_ENCAPSED_STRING|"|4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |4
PHP_CURLY_OPEN|{|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_CURLY_CLOSE|} |4
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|}|4
PHP_CONSTANT_ENCAPSED_STRING|"|2
PHP_SEMICOLON|;|2
WHITESPACE|
    |2
PHP_ECHO|echo|2
WHITESPACE| |2
PHP_CONSTANT_ENCAPSED_STRING|`|8
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |8
PHP_CURLY_OPEN|{|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_VARIABLE|$a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|} |8
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_CURLY_CLOSE|} |8
PHP_TOKEN|$|30
PHP_CURLY_OPEN|{|30
PHP_ENCAPSED_VARIABLE|a|2
PHP_TOKEN|[|2
PHP_NUMBER|0|2
PHP_TOKEN|]|2
PHP_CURLY_CLOSE|}|8
PHP_CONSTANT_ENCAPSED_STRING|`|2
PHP_SEMICOLON|;|2
WHITESPACE|
|2
PHP_CURLY_CLOSE|}
|2
PHP_CLOSETAG|?>|2
