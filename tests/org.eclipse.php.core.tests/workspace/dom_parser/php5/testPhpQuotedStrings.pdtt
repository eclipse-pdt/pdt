--TEST--
Bug 514572 - Do better variable detection, highlighting and renaming in quoted strings and heredoc sections
--FILE--
<?php
$a(<<<NESTED
    ${a[$a[]]} {$a[$a[$a[$a[]]]]} ${a} ${a[0]}
NESTED
);

$a = 5;
echo "${a[$a[]]} {$a[$a[$a[$a[]]]]} ${a} ${a[0]}";
echo '${a[$a[]]} {$a[$a[$a[$a[]]]]} ${a} ${a[0]}';

function a()
{
    global $a;
    $a = 10;
    $b = ${a};
    echo "${a[$a[]]} {$a[$a[$a[$a[]]]]} ${a} ${a[0]}";
}
?>
--EXPECT--
<Program start='0' length='305'>
	<Statements>
		<ExpressionStatement start='6' length='69'>
			<FunctionInvocation start='6' length='68'>
				<FunctionName start='6' length='2'>
					<Variable start='6' length='2' isDollared='true'>
						<Identifier start='7' length='1' name='a'/>
					</Variable>
				</FunctionName>
				<Parameters>
					<Quote start='9' length='63' type='heredoc'>
						<Scalar start='19' length='4' type='string' value='    '/>
						<ReflectionVariable start='23' length='10'>
							<ArrayAccess start='25' length='7' type='array'>
								<Variable start='25' length='1' isDollared='false'>
									<Identifier start='25' length='1' name='a'/>
								</Variable>
								<Index>
									<ArrayAccess start='27' length='4' type='array'>
										<Variable start='27' length='2' isDollared='true'>
											<Identifier start='28' length='1' name='a'/>
										</Variable>
										<Index>
										</Index>
									</ArrayAccess>
								</Index>
							</ArrayAccess>
						</ReflectionVariable>
						<Scalar start='33' length='1' type='string' value=' '/>
						<ReflectionVariable start='34' length='18'>
							<ArrayAccess start='35' length='16' type='array'>
								<Variable start='35' length='2' isDollared='true'>
									<Identifier start='36' length='1' name='a'/>
								</Variable>
								<Index>
									<ArrayAccess start='38' length='12' type='array'>
										<Variable start='38' length='2' isDollared='true'>
											<Identifier start='39' length='1' name='a'/>
										</Variable>
										<Index>
											<ArrayAccess start='41' length='8' type='array'>
												<Variable start='41' length='2' isDollared='true'>
													<Identifier start='42' length='1' name='a'/>
												</Variable>
												<Index>
													<ArrayAccess start='44' length='4' type='array'>
														<Variable start='44' length='2' isDollared='true'>
															<Identifier start='45' length='1' name='a'/>
														</Variable>
														<Index>
														</Index>
													</ArrayAccess>
												</Index>
											</ArrayAccess>
										</Index>
									</ArrayAccess>
								</Index>
							</ArrayAccess>
						</ReflectionVariable>
						<Scalar start='52' length='1' type='string' value=' '/>
						<ReflectionVariable start='53' length='4'>
							<Variable start='55' length='1' isDollared='false'>
								<Identifier start='55' length='1' name='a'/>
							</Variable>
						</ReflectionVariable>
						<Scalar start='57' length='1' type='string' value=' '/>
						<ReflectionVariable start='58' length='7'>
							<ArrayAccess start='60' length='4' type='array'>
								<Variable start='60' length='1' isDollared='false'>
									<Identifier start='60' length='1' name='a'/>
								</Variable>
								<Index>
									<Scalar start='62' length='1' type='int' value='0'/>
								</Index>
							</ArrayAccess>
						</ReflectionVariable>
						<Scalar start='65' length='6' type='string' value='
'/>
					</Quote>
				</Parameters>
			</FunctionInvocation>
		</ExpressionStatement>
		<ExpressionStatement start='77' length='7'>
			<Assignment start='77' length='6' operator='='>
				<Variable start='77' length='2' isDollared='true'>
					<Identifier start='78' length='1' name='a'/>
				</Variable>
				<Value>
					<Scalar start='82' length='1' type='int' value='5'/>
				</Value>
			</Assignment>
		</ExpressionStatement>
		<EchoStatement start='85' length='50'>
			<Quote start='90' length='44' type='quote'>
				<ReflectionVariable start='91' length='10'>
					<ArrayAccess start='93' length='7' type='array'>
						<Variable start='93' length='1' isDollared='false'>
							<Identifier start='93' length='1' name='a'/>
						</Variable>
						<Index>
							<ArrayAccess start='95' length='4' type='array'>
								<Variable start='95' length='2' isDollared='true'>
									<Identifier start='96' length='1' name='a'/>
								</Variable>
								<Index>
								</Index>
							</ArrayAccess>
						</Index>
					</ArrayAccess>
				</ReflectionVariable>
				<Scalar start='101' length='1' type='string' value=' '/>
				<ReflectionVariable start='102' length='18'>
					<ArrayAccess start='103' length='16' type='array'>
						<Variable start='103' length='2' isDollared='true'>
							<Identifier start='104' length='1' name='a'/>
						</Variable>
						<Index>
							<ArrayAccess start='106' length='12' type='array'>
								<Variable start='106' length='2' isDollared='true'>
									<Identifier start='107' length='1' name='a'/>
								</Variable>
								<Index>
									<ArrayAccess start='109' length='8' type='array'>
										<Variable start='109' length='2' isDollared='true'>
											<Identifier start='110' length='1' name='a'/>
										</Variable>
										<Index>
											<ArrayAccess start='112' length='4' type='array'>
												<Variable start='112' length='2' isDollared='true'>
													<Identifier start='113' length='1' name='a'/>
												</Variable>
												<Index>
												</Index>
											</ArrayAccess>
										</Index>
									</ArrayAccess>
								</Index>
							</ArrayAccess>
						</Index>
					</ArrayAccess>
				</ReflectionVariable>
				<Scalar start='120' length='1' type='string' value=' '/>
				<ReflectionVariable start='121' length='4'>
					<Variable start='123' length='1' isDollared='false'>
						<Identifier start='123' length='1' name='a'/>
					</Variable>
				</ReflectionVariable>
				<Scalar start='125' length='1' type='string' value=' '/>
				<ReflectionVariable start='126' length='7'>
					<ArrayAccess start='128' length='4' type='array'>
						<Variable start='128' length='1' isDollared='false'>
							<Identifier start='128' length='1' name='a'/>
						</Variable>
						<Index>
							<Scalar start='130' length='1' type='int' value='0'/>
						</Index>
					</ArrayAccess>
				</ReflectionVariable>
			</Quote>
		</EchoStatement>
		<EchoStatement start='136' length='50'>
			<Scalar start='141' length='44' type='string' value='&apos;${a[$a[]]} {$a[$a[$a[$a[]]]]} ${a} ${a[0]}&apos;'/>
		</EchoStatement>
		<FunctionDeclaration start='188' length='114' isReference='false'>
			<FunctionName>
				<Identifier start='197' length='1' name='a'/>
			</FunctionName>
			<FormalParameters>
			</FormalParameters>
			<FunctionBody>
				<Block start='201' length='101' isCurly='true'>
					<GlobalStatement start='207' length='10'>
						<Variable start='214' length='2' isDollared='true'>
							<Identifier start='215' length='1' name='a'/>
						</Variable>
					</GlobalStatement>
					<ExpressionStatement start='222' length='8'>
						<Assignment start='222' length='7' operator='='>
							<Variable start='222' length='2' isDollared='true'>
								<Identifier start='223' length='1' name='a'/>
							</Variable>
							<Value>
								<Scalar start='227' length='2' type='int' value='10'/>
							</Value>
						</Assignment>
					</ExpressionStatement>
					<ExpressionStatement start='235' length='10'>
						<Assignment start='235' length='9' operator='='>
							<Variable start='235' length='2' isDollared='true'>
								<Identifier start='236' length='1' name='b'/>
							</Variable>
							<Value>
								<ReflectionVariable start='240' length='4'>
									<Scalar start='242' length='1' type='string' value='a'/>
								</ReflectionVariable>
							</Value>
						</Assignment>
					</ExpressionStatement>
					<EchoStatement start='250' length='50'>
						<Quote start='255' length='44' type='quote'>
							<ReflectionVariable start='256' length='10'>
								<ArrayAccess start='258' length='7' type='array'>
									<Variable start='258' length='1' isDollared='false'>
										<Identifier start='258' length='1' name='a'/>
									</Variable>
									<Index>
										<ArrayAccess start='260' length='4' type='array'>
											<Variable start='260' length='2' isDollared='true'>
												<Identifier start='261' length='1' name='a'/>
											</Variable>
											<Index>
											</Index>
										</ArrayAccess>
									</Index>
								</ArrayAccess>
							</ReflectionVariable>
							<Scalar start='266' length='1' type='string' value=' '/>
							<ReflectionVariable start='267' length='18'>
								<ArrayAccess start='268' length='16' type='array'>
									<Variable start='268' length='2' isDollared='true'>
										<Identifier start='269' length='1' name='a'/>
									</Variable>
									<Index>
										<ArrayAccess start='271' length='12' type='array'>
											<Variable start='271' length='2' isDollared='true'>
												<Identifier start='272' length='1' name='a'/>
											</Variable>
											<Index>
												<ArrayAccess start='274' length='8' type='array'>
													<Variable start='274' length='2' isDollared='true'>
														<Identifier start='275' length='1' name='a'/>
													</Variable>
													<Index>
														<ArrayAccess start='277' length='4' type='array'>
															<Variable start='277' length='2' isDollared='true'>
																<Identifier start='278' length='1' name='a'/>
															</Variable>
															<Index>
															</Index>
														</ArrayAccess>
													</Index>
												</ArrayAccess>
											</Index>
										</ArrayAccess>
									</Index>
								</ArrayAccess>
							</ReflectionVariable>
							<Scalar start='285' length='1' type='string' value=' '/>
							<ReflectionVariable start='286' length='4'>
								<Variable start='288' length='1' isDollared='false'>
									<Identifier start='288' length='1' name='a'/>
								</Variable>
							</ReflectionVariable>
							<Scalar start='290' length='1' type='string' value=' '/>
							<ReflectionVariable start='291' length='7'>
								<ArrayAccess start='293' length='4' type='array'>
									<Variable start='293' length='1' isDollared='false'>
										<Identifier start='293' length='1' name='a'/>
									</Variable>
									<Index>
										<Scalar start='295' length='1' type='int' value='0'/>
									</Index>
								</ArrayAccess>
							</ReflectionVariable>
						</Quote>
					</EchoStatement>
				</Block>
			</FunctionBody>
		</FunctionDeclaration>
		<EmptyStatement start='303' length='2'/>
	</Statements>
	<Comments>
	</Comments>
</Program>